<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>K√ºt√ºphanem</title>
    <style>
        /* --- TEMEL STƒ∞LLER --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)), url('https://images.unsplash.com/photo-1507842217343-583bb7270b66?q=80&w=1080&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
            margin: 0; padding: 0;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px;
        }

        /* NUMARA OKLARINI Gƒ∞ZLEME (Temiz G√∂r√ºn√ºm ƒ∞√ßin) */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* HEADER */
        .header {
            background-color: rgba(255, 255, 255, 0.80);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 15px; text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            position: sticky; top: 0; z-index: 100;
            padding-top: env(safe-area-inset-top);
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }
        .header h1 { margin: 0; font-size: 17px; font-weight: 600; letter-spacing: -0.5px; color: #1c1c1e; }

        /* DASHBOARD */
        .dashboard {
            display: flex; justify-content: space-between; background: rgba(255,255,255,0.90);
            margin: 20px 20px 0 20px; padding: 15px; border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.5);
        }
        .dash-item { text-align: center; flex: 1; }
        .dash-val { display: block; font-size: 22px; font-weight: 700; color: #007aff; letter-spacing: -1px; }
        .dash-lbl { display: block; font-size: 11px; color: #8e8e93; font-weight: 600; text-transform: uppercase; margin-top: 2px;}
        .dash-sep { width: 1px; background: #e5e5ea; margin: 0 10px; }

        /* KONTROLLER */
        .controls { 
            padding: 0 20px; margin-top: 20px; margin-bottom: 25px; 
            display: flex; gap: 12px; align-items: center; 
        }
        .search-box, .filter-select {
            height: 50px; padding: 0 15px; border: 1px solid rgba(0,0,0,0.1);
            border-radius: 12px; font-size: 15px; box-sizing: border-box; outline: none;
            margin-bottom: 0 !important; background-color: rgba(255,255,255,0.95); color: #1c1c1e;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); transition: all 0.2s;
        }
        .search-box:focus, .filter-select:focus { border-color: #007aff; box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
        .search-box { flex: 2; }
        .filter-select { flex: 1; -webkit-appearance: none; }

        /* Lƒ∞STE */
        .container { padding: 0 20px; max-width: 600px; margin: 0 auto; }
        .book-item {
            background-color: rgba(255,255,255,0.95); padding: 16px; border-radius: 16px; margin-bottom: 12px;
            display: flex; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer;
            transition: transform 0.1s ease, background-color 0.2s; border: 1px solid rgba(255,255,255,0.6);
        }
        .book-item:active { transform: scale(0.98); background-color: #f2f2f7; }
        .book-icon { font-size: 26px; background-color: #f2f2f7; width: 54px; height: 54px; display: flex; align-items: center; justify-content: center; border-radius: 12px; margin-right: 16px; }
        .book-info { flex: 1; overflow: hidden; }
        .book-title { font-size: 16px; font-weight: 600; color: #1c1c1e; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; letter-spacing: -0.3px; }
        .book-author { font-size: 14px; color: #8e8e93; margin-top: 4px; display: block; font-weight: 500; }
        .arrow { color: #d1d1d6; font-size: 20px; font-weight: bold; }

        /* YAZAR GRID */
        .author-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding-top: 20px;}
        .author-tile {
            background-color: rgba(255,255,255,0.95); padding: 25px 15px; border-radius: 20px; text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.1s;
            border: 1px solid rgba(255,255,255,0.6);
        }
        .author-tile:active { transform: scale(0.96); background-color: #f9f9f9; }
        .tile-icon { font-size: 32px; margin-bottom: 10px; display: block; }
        .tile-name { font-size: 16px; font-weight: 600; color: #333; display: block; margin-bottom: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
        .tile-count { font-size: 11px; color: white; background-color: #5856d6; padding: 5px 12px; border-radius: 20px; font-weight: 700; letter-spacing: 0.5px; }

        /* BUTONLAR */
        .btn { background-color: #007aff; color: white; border: none; padding: 16px; border-radius: 14px; width: 100%; font-size: 17px; font-weight: 600; cursor: pointer; transition: transform 0.1s, background-color 0.2s; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
        .btn:active { transform: scale(0.98); background-color: #0062cc; }
        .btn:disabled { background-color: #b4d5fe; transform: none; box-shadow: none; }
        
        .btn-magic { background-color: #ff9500; width: auto; border-radius: 0 14px 14px 0; padding: 0 24px; font-size: 24px; border: none; box-shadow: none; }
        .btn-magic:active { background-color: #e08300; }
        
        .btn-random { 
            background: linear-gradient(135deg, #5856d6, #7a78e0); color: white; border: none; padding: 12px 24px; border-radius: 30px; 
            font-size: 14px; font-weight: 600; margin: 20px auto 0 auto; display: block; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(88, 86, 214, 0.4); transition: transform 0.1s;
        }
        .btn-random:active { transform: scale(0.95); }
        .btn-delete { background-color: #fff; color: #ff3b30; border: 2px solid #ff3b30; padding: 14px; border-radius: 14px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 25px; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; }
        .btn-delete:active { background-color: #ffe5e5; }

        /* INPUTLAR */
        .container input[type="text"], .container input[type="number"] { 
            width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid #e5e5ea; 
            border-radius: 14px; font-size: 16px; background-color: rgba(255,255,255,0.9); box-sizing: border-box; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .isbn-row { display: flex; }
        .isbn-input { border-radius: 14px 0 0 14px !important; margin-bottom: 20px !important; }

        /* TAB BAR */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background-color: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0,0,0,0.1); display: flex; justify-content: space-around;
            padding-bottom: env(safe-area-inset-bottom); z-index: 100;
        }
        .tab-btn { background: none; border: none; padding: 12px; flex: 1; text-align: center; color: #aeaeb2; cursor: pointer; transition: color 0.2s; }
        .tab-btn.active { color: #007aff; }
        .tab-icon { font-size: 26px; display: block; margin-bottom: 4px; transition: transform 0.2s; }
        .tab-btn.active .tab-icon { transform: translateY(-2px); }
        .tab-text { font-size: 10px; font-weight: 600; letter-spacing: 0.3px; }

        /* POPUP & MODAL */
        .success-popup {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
            background: rgba(255,255,255,0.98); padding: 30px; border-radius: 24px; text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2); z-index: 300; opacity: 0; pointer-events: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px); width: 80%; max-width: 300px;
        }
        .success-popup.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: all;}
        .success-icon { font-size: 60px; margin-bottom: 15px; display: block; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.4); backdrop-filter: blur(3px); z-index: 200; justify-content: center; align-items: flex-end; }
        .modal-content { background-color: #fbfbfd; width: 100%; max-width: 600px; height: 92%; border-radius: 24px 24px 0 0; padding: 25px; box-sizing: border-box; overflow-y: auto; position: relative; animation: slideUp 0.3s ease-out; margin: 0 auto; box-shadow: 0 -10px 40px rgba(0,0,0,0.1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .close-btn { position: absolute; top: 20px; right: 20px; color: #007aff; font-weight: 700; background: #e5f1ff; border: none; padding: 8px 16px; border-radius: 20px; font-size: 14px; cursor: pointer; z-index: 10; }

        /* DETAY */
        .detail-cover { width: 140px; height: 210px; background-color: #ddd; border-radius: 12px; margin: 30px auto; display: block; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.25); transform: rotate(-2deg); border: 4px solid white; }
        .detail-title { font-size: 24px; font-weight: 800; text-align: center; margin-bottom: 5px; color: #1c1c1e; letter-spacing: -0.5px; }
        .detail-author { font-size: 18px; color: #8e8e93; text-align: center; margin-bottom: 30px; display: block; font-weight: 500; }
        .info-row { display: flex; justify-content: center; margin-bottom: 30px; gap: 15px; }
        .info-box { background-color: white; padding: 15px 25px; border-radius: 16px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.03); min-width: 80px; }
        .info-label { font-size: 11px; color: #8e8e93; display: block; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; margin-bottom: 4px; }
        .info-value { font-size: 18px; font-weight: 800; color: #1c1c1e; }
        .desc { font-size: 16px; line-height: 1.6; color: #3a3a3c; text-align: justify; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .hidden { display: none !important; }
        .loading { text-align: center; color: #8e8e93; padding: 30px; font-size: 14px; font-weight: 500; }
    </style>
</head>
<body>

    <div class="header">
        <h1 id="header-title">K√ºt√ºphanem üìö</h1>
    </div>

    <div id="page-library">
        <div class="dashboard">
            <div class="dash-item"><span class="dash-val" id="stat-total">-</span><span class="dash-lbl">Kitap</span></div>
            <div class="dash-sep"></div>
            <div class="dash-item"><span class="dash-val" id="stat-authors">-</span><span class="dash-lbl">Yazar</span></div>
        </div>
        <button class="btn-random" onclick="pickRandomBook()">üé≤ Ne Okusam?</button>
        <div class="controls">
            <input type="text" id="search-input" class="search-box" placeholder="Kitap ara..." onkeyup="applyFilters()">
            <select id="author-filter" class="filter-select" onchange="applyFilters()">
                <option value="">T√ºm Yazarlar</option>
            </select>
        </div>
        <div class="container" style="padding-top: 0;">
            <div id="loading-spinner" class="loading hidden">Veriler g√ºncelleniyor...</div>
            <div id="book-list"></div>
            <div id="empty-msg" class="loading hidden" style="color:#999; margin-top: 30px; text-align: center;">üîç Kitap bulunamadƒ±.</div>
        </div>
    </div>

    <div id="page-authors" class="container hidden">
        <div id="authors-grid" class="author-grid"></div>
    </div>

    <div id="page-login" class="container hidden" style="text-align: center; padding-top: 60px;">
        <div style="font-size: 60px; margin-bottom: 25px; background:white; width:110px; height:110px; line-height:110px; border-radius:50%; margin:0 auto 25px auto; box-shadow:0 10px 30px rgba(0,0,0,0.1);">üîê</div>
        <h2 style="margin-bottom: 10px; color:#1c1c1e;">Y√∂netici Giri≈üi</h2>
        <p style="color:#8e8e93; margin-bottom: 30px;">Kitap eklemek veya silmek i√ßin ≈üifre girin.</p>
        
        <input type="number" id="pin-input" placeholder="≈ûifre" inputmode="numeric" style="text-align: center; font-size: 24px; letter-spacing: 5px;">
        
        <button class="btn" onclick="checkLogin()">Giri≈ü Yap</button>
    </div>

    <div id="page-add" class="container hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0; font-size: 22px;">Yeni Kitap Kaydƒ±</h3>
            <span onclick="logout()" style="color:#ff3b30; font-weight:bold; cursor:pointer; background: rgba(255,59,48,0.1); padding: 5px 12px; border-radius: 12px; font-size: 14px;">√áƒ±kƒ±≈ü</span>
        </div>
        <label style="font-size:13px; color:#8e8e93; font-weight:600; margin-bottom:8px; display:block;">OTOMATƒ∞K DOLDUR</label>
        <div class="isbn-row">
            
            <input type="number" id="isbn-input" class="isbn-input" placeholder="Barkod No (ISBN)" inputmode="numeric">
            
            <button class="btn-magic" onclick="fetchByISBN()">ü™Ñ</button>
        </div>
        
        <label style="font-size:13px; color:#8e8e93; font-weight:600; margin-bottom:8px; display:block;">MANUEL Gƒ∞Rƒ∞≈û</label>
        <input type="text" id="title-input" placeholder="Kitap Adƒ±">
        <input type="text" id="author-input" placeholder="Yazar Adƒ±">
        <button id="save-btn" class="btn" onclick="saveBook()">Envantere Kaydet</button>
    </div>

    <div id="success-popup" class="success-popup">
        <span class="success-icon">üéâ</span>
        <h2 style="margin:10px 0; color:#1c1c1e;">Harika!</h2>
        <p style="color:#8e8e93; margin:0;">Kitap ba≈üarƒ±yla raflara eklendi.</p>
    </div>

    <div id="author-modal" class="modal-overlay" onclick="closeModal(event, 'author-modal')">
        <div class="modal-content">
            <button class="close-btn" onclick="toggleModal('author-modal', false)">Kapat</button>
            <div id="author-modal-body"></div>
        </div>
    </div>
    <div id="detail-modal" class="modal-overlay" onclick="closeModal(event, 'detail-modal')">
        <div class="modal-content" style="z-index: 210;">
            <button class="close-btn" onclick="toggleModal('detail-modal', false)">Kapat</button>
            <div id="detail-modal-body"></div>
        </div>
    </div>

    <div class="tab-bar">
        <button class="tab-btn active" id="tab-library" onclick="switchTab('library')">
            <span class="tab-icon">üìö</span><span class="tab-text">K√ºt√ºphane</span>
        </button>
        <button class="tab-btn" id="tab-authors" onclick="switchTab('authors')">
            <span class="tab-icon">üë§</span><span class="tab-text">Yazarlar</span>
        </button>
        <button class="tab-btn" id="tab-add" onclick="switchTab('add')">
            <span class="tab-icon">‚ûï</span><span class="tab-text">Ekle</span>
        </button>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby7oenOOtjnNkDTQs7G8HdaLkekcQyhhutWpELd_6LtAJ-qc9J6qnUQvthCWVgmzuqibg/exec"; 
        const ADMIN_PIN = "5555";
        let allBooks = [];
        let isLoggedIn = false;
        let currentDetailBook = null;

        window.onload = function() {
            const cachedData = localStorage.getItem('kutuphanem_data');
            if (cachedData) {
                try { allBooks = JSON.parse(cachedData); refreshUI(); } catch(e) {}
            }
            fetchBooks(); 
        };

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.className = 'tab-btn');
            if(tab === 'library') document.getElementById('tab-library').className = 'tab-btn active';
            if(tab === 'authors') document.getElementById('tab-authors').className = 'tab-btn active';
            if(tab === 'add') document.getElementById('tab-add').className = 'tab-btn active';

            ['page-library', 'page-authors', 'page-login', 'page-add'].forEach(id => document.getElementById(id).classList.add('hidden'));
            const header = document.getElementById('header-title');
            if (tab === 'library') {
                header.innerText = 'K√ºt√ºphanem üìö'; document.getElementById('page-library').classList.remove('hidden');
            } else if (tab === 'authors') {
                header.innerText = 'Yazarlar üë§'; renderAuthorsPage(); document.getElementById('page-authors').classList.remove('hidden');
            } else {
                header.innerText = 'Y√∂netici Paneli üîê'; document.getElementById(isLoggedIn ? 'page-add' : 'page-login').classList.remove('hidden');
            }
        }

        function fetchBooks() {
            const spinner = document.getElementById('loading-spinner');
            if(allBooks.length === 0) spinner.classList.remove('hidden');
            fetch(API_URL)
                .then(res => res.json())
                .then(data => {
                    const newData = data.map(b => ({
                        ad: b.ad ? String(b.ad).trim() : "ƒ∞simsiz",
                        yazar: b.yazar ? String(b.yazar).trim() : "Bilinmiyor"
                    }));
                    if (JSON.stringify(newData) !== JSON.stringify(allBooks)) {
                        allBooks = newData;
                        localStorage.setItem('kutuphanem_data', JSON.stringify(allBooks));
                        refreshUI();
                    }
                })
                .catch(err => { if(allBooks.length===0) document.getElementById('book-list').innerHTML = '<div class="error-msg">Baƒülantƒ± hatasƒ±!</div>'; })
                .finally(() => spinner.classList.add('hidden'));
        }

        function refreshUI() { updateStats(); updateAuthorFilter(); applyFilters(); renderAuthorsPage(); }
        function showSuccessPopup() {
            const popup = document.getElementById('success-popup');
            popup.classList.add('active');
            setTimeout(() => { popup.classList.remove('active'); }, 2500);
        }

        function renderAuthorsPage() { const container = document.getElementById('authors-grid'); container.innerHTML = ''; const groups = {}; allBooks.forEach(book => { const author = book.yazar || "Bilinmiyor"; if (!groups[author]) groups[author] = []; groups[author].push(book); }); const sortedAuthors = Object.keys(groups).sort(); if (sortedAuthors.length === 0) { container.innerHTML = '<div style="grid-column: span 2; text-align:center; color:#999;">Yazar yok.</div>'; return; } sortedAuthors.forEach(author => { const count = groups[author].length; const tile = document.createElement('div'); tile.className = 'author-tile'; tile.onclick = () => openAuthorBooks(author, groups[author]); tile.innerHTML = `<span class="tile-icon">üë§</span><span class="tile-name">${author}</span><span class="tile-count">${count} Kitap</span>`; container.appendChild(tile); }); }
        function openAuthorBooks(authorName, books) { const body = document.getElementById('author-modal-body'); body.innerHTML = `<h2 style="margin-top:0; text-align:center; margin-bottom:20px;">${authorName}</h2>`; books.forEach(book => { const item = document.createElement('div'); item.className = 'book-item'; item.onclick = () => showBookDetail(book); item.innerHTML = `<div class="book-icon">üìñ</div><div class="book-info"><span class="book-title">${book.ad}</span></div><span class="arrow">‚Ä∫</span>`; body.appendChild(item); }); toggleModal('author-modal', true); }
        function updateStats() { document.getElementById('stat-total').innerText = allBooks.length; const authors = new Set(allBooks.map(b => b.yazar)); document.getElementById('stat-authors').innerText = authors.size; }
        function updateAuthorFilter() { const select = document.getElementById('author-filter'); while (select.options.length > 1) { select.remove(1); } const authors = [...new Set(allBooks.map(b => b.yazar))].sort(); authors.forEach(auth => { if(auth) { const opt = document.createElement('option'); opt.value = auth; opt.innerText = auth; select.appendChild(opt); } }); }
        function applyFilters() { const query = document.getElementById('search-input').value.toLowerCase(); const authorFilter = document.getElementById('author-filter').value; const filtered = allBooks.filter(book => { return (book.ad.toLowerCase().includes(query) || book.yazar.toLowerCase().includes(query)) && (authorFilter === "" || book.yazar === authorFilter); }); renderBooks(filtered); }
        function renderBooks(books) { const list = document.getElementById('book-list'); const emptyMsg = document.getElementById('empty-msg'); list.innerHTML = ''; if (books.length === 0) { emptyMsg.classList.remove('hidden'); return; } emptyMsg.classList.add('hidden'); books.forEach(book => { const item = document.createElement('div'); item.className = 'book-item'; item.onclick = () => showBookDetail(book); item.innerHTML = `<div class="book-icon">üìñ</div><div class="book-info"><span class="book-title">${book.ad}</span><span class="book-author">${book.yazar}</span></div><span class="arrow">‚Ä∫</span>`; list.appendChild(item); }); }
        function pickRandomBook() { if (allBooks.length === 0) return; const book = allBooks[Math.floor(Math.random() * allBooks.length)]; alert("üé≤ Bug√ºn ≈ûunu Oku:\n\n" + book.ad + "\n" + book.yazar); }
        function showBookDetail(book) { currentDetailBook = book; const body = document.getElementById('detail-modal-body'); body.innerHTML = '<div class="loading">Y√ºkleniyor...</div>'; toggleModal('detail-modal', true); const query = `intitle:${book.ad}+inauthor:${book.yazar}`; fetch(`https://www.googleapis.com/books/v1/volumes?q=${query}&maxResults=1`).then(res => res.json()).then(data => { let img='', pageCount='-', year='-', desc='√ñzet bilgisi bulunamadƒ±.'; if (data.items?.length > 0) { const info = data.items[0].volumeInfo; if (info.imageLinks?.thumbnail) img = info.imageLinks.thumbnail.replace('http:', 'https:'); pageCount = info.pageCount || '-'; year = info.publishedDate?.substring(0,4) || '-'; desc = info.description || desc; } let deleteBtn = ''; if (isLoggedIn) { deleteBtn = `<button class="btn-delete" onclick="deleteBook()">üóëÔ∏è Bu Kitabƒ± Sil</button>`; } body.innerHTML = `${img ? `<img src="${img}" class="detail-cover">` : '<div class="detail-cover" style="display:flex;align-items:center;justify-content:center;font-size:40px;">üìö</div>'}<div class="detail-title">${book.ad}</div><span class="detail-author">${book.yazar}</span><div class="info-row"><div class="info-box"><span class="info-label">Sayfa</span><span class="info-value">${pageCount}</span></div><div class="info-box"><span class="info-label">Yƒ±l</span><span class="info-value">${year}</span></div></div><h4>√ñzet</h4><div class="desc">${desc}</div>${deleteBtn}`; }).catch(() => body.innerHTML = '<p>Detay yok.</p>'); }
        function toggleModal(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
        function closeModal(e, id) { if (e.target.id === id) toggleModal(id, false); }
        function checkLogin() { if (document.getElementById('pin-input').value === ADMIN_PIN) { isLoggedIn = true; document.getElementById('pin-input').value = ''; switchTab('add'); } else { alert("Hatalƒ± ≈ûifre!"); } }
        function logout() { isLoggedIn = false; switchTab('add'); }
        function fetchByISBN() { const isbn = document.getElementById('isbn-input').value; if (isbn.length < 5) { alert("Ge√ßersiz No"); return; } const btn = document.querySelector('.btn-magic'); btn.innerText = '‚è≥'; fetch(`https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`).then(res => res.json()).then(data => { if (data.items?.length > 0) { const info = data.items[0].volumeInfo; document.getElementById('title-input').value = info.title || ""; document.getElementById('author-input').value = info.authors?.join(", ") || ""; alert(`Bulundu: ${info.title}`); } else { alert("Bulunamadƒ±."); } }).catch(() => alert("Hata.")).finally(() => btn.innerText = 'ü™Ñ'); }
        
        function deleteBook() {
            if (!confirm(`"${currentDetailBook.ad}" silinsin mi?`)) return;
            const btn = document.querySelector('.btn-delete'); btn.innerText = 'Siliniyor...'; btn.disabled = true;
            fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', ad: currentDetailBook.ad, yazar: currentDetailBook.yazar }) })
            .then(res => res.json()).then(data => {
                if(data.status === "Silindi") {
                    allBooks = allBooks.filter(b => b.ad !== currentDetailBook.ad || b.yazar !== currentDetailBook.yazar);
                    localStorage.setItem('kutuphanem_data', JSON.stringify(allBooks));
                    refreshUI(); toggleModal('detail-modal', false); toggleModal('author-modal', false);
                    alert("Kitap silindi.");
                } else { alert("Silinemedi."); }
            }).catch(() => alert("Hata.")).finally(() => { if(btn) { btn.innerText = 'üóëÔ∏è Sil'; btn.disabled = false; } });
        }

        function saveBook() {
            const adInput = document.getElementById('title-input').value.trim();
            const yazarInput = document.getElementById('author-input').value.trim();
            if (!adInput || !yazarInput) { alert("Eksik bilgi."); return; }
            if (allBooks.some(book => book.ad.toLowerCase() === adInput.toLowerCase() && book.yazar.toLowerCase() === yazarInput.toLowerCase())) { alert("‚ö†Ô∏è Bu kitap zaten mevcut!"); return; }

            const saveBtn = document.getElementById('save-btn'); saveBtn.disabled = true; saveBtn.innerText = 'Kaydediliyor...';
            fetch(API_URL, { method: 'POST', body: JSON.stringify({ ad: adInput, yazar: yazarInput }) })
            .then(() => {
                showSuccessPopup();
                ['title-input', 'author-input', 'isbn-input'].forEach(id => document.getElementById(id).value = '');
                fetchBooks(); 
            }).catch(() => alert("Hata.")).finally(() => { saveBtn.disabled = false; saveBtn.innerText = 'Envantere Kaydet'; });
        }
    </script>
</body>
</html>
